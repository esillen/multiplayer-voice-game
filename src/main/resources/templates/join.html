<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/header :: head('Voice Pong - Join Game')}"></head>
<body>
    <div class="scanlines"></div>
    <div class="container">
        <header th:replace="~{fragments/header :: navbar}"></header>
        
        <main class="join-page">
            <h1 class="page-title">JOIN GAME</h1>
            
            <form id="joinForm" class="join-form">
                <div class="form-group">
                    <label for="playerName">ENTER YOUR NAME</label>
                    <input type="text" id="playerName" name="name" 
                           required maxlength="12" placeholder="PLAYER 1"
                           autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label>CLICK A PADDLE TO JOIN</label>
                    <div class="side-selector">
                        <label class="side-option" th:classappend="${leftTaken} ? 'disabled' : ''">
                            <input type="radio" name="side" value="LEFT" 
                                   th:disabled="${leftTaken}" required>
                            <div class="side-card">
                                <div class="side-visual left-side">
                                    <div class="mini-paddle"></div>
                                </div>
                                <span class="side-label">LEFT PADDLE</span>
                                <span class="side-status" th:if="${leftTaken}">
                                    Taken by <span th:text="${leftPlayerName}">Player</span>
                                </span>
                                <span class="side-status available" th:unless="${leftTaken}">
                                    Available
                                </span>
                            </div>
                        </label>
                        
                        <label class="side-option" th:classappend="${rightTaken} ? 'disabled' : ''">
                            <input type="radio" name="side" value="RIGHT"
                                   th:disabled="${rightTaken}" required>
                            <div class="side-card">
                                <div class="side-visual right-side">
                                    <div class="mini-paddle"></div>
                                </div>
                                <span class="side-label">RIGHT PADDLE</span>
                                <span class="side-status" th:if="${rightTaken}">
                                    Taken by <span th:text="${rightPlayerName}">Player</span>
                                </span>
                                <span class="side-status available" th:unless="${rightTaken}">
                                    Available
                                </span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div id="nameError" class="name-error" style="display: none;">
                    Please enter your name first
                </div>
            </form>
            
            <div class="join-info" th:if="${leftTaken and rightTaken}">
                <p class="warning">Both sides are taken! You can <a th:href="@{/spectate}">spectate</a> instead.</p>
            </div>
        </main>
        
        <footer th:replace="~{fragments/footer :: footer}"></footer>
    </div>
    
    <script>
        const nameInput = document.getElementById('playerName');
        const nameError = document.getElementById('nameError');
        const sideOptions = document.querySelectorAll('.side-option:not(.disabled)');
        
        // Load saved name from localStorage
        const savedName = localStorage.getItem('playerName');
        if (savedName) {
            nameInput.value = savedName;
        }
        
        // Save name as user types
        nameInput.addEventListener('input', () => {
            nameError.style.display = 'none';
        });
        
        // Click on side card to join immediately
        sideOptions.forEach(option => {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                
                const name = nameInput.value.trim();
                if (!name) {
                    nameError.style.display = 'block';
                    nameInput.focus();
                    return;
                }
                
                const radio = this.querySelector('input[type="radio"]');
                if (radio && !radio.disabled) {
                    // Save name to localStorage
                    localStorage.setItem('playerName', name);
                    
                    // Navigate to game
                    window.location.href = '/play?name=' + encodeURIComponent(name) + '&side=' + radio.value;
                }
            });
        });
        
        // Also handle form submit (enter key)
        document.getElementById('joinForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = nameInput.value.trim();
            const side = document.querySelector('input[name="side"]:checked');
            
            if (!name) {
                nameError.style.display = 'block';
                nameInput.focus();
                return;
            }
            if (!side) {
                // Focus on selecting a side
                return;
            }
            
            localStorage.setItem('playerName', name);
            window.location.href = '/play?name=' + encodeURIComponent(name) + '&side=' + side.value;
        });
    </script>
</body>
</html>

