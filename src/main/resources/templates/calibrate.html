<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/header :: head('Voice Calibration')}"></head>
<body>
    <div class="scanlines"></div>
    <div class="container calibrate-container">
        <header th:replace="~{fragments/header :: navbar}"></header>
        
        <main class="calibrate-page">
            <h1 class="page-title">VOICE CALIBRATION</h1>
            
            <!-- Enhanced Pitch Meter with Draggable Thresholds -->
            <div class="pitch-meter-section">
                <h3>PITCH THRESHOLDS</h3>
                <div class="pitch-meter-container">
                    <div class="pitch-scale">
                        <span>60 Hz</span>
                        <span>200 Hz</span>
                        <span>350 Hz</span>
                        <span>500 Hz</span>
                    </div>
                    <div class="pitch-meter-bar" id="pitchMeterBar">
                        <!-- Current pitch marker -->
                        <div class="pitch-marker" id="pitchMarker"></div>
                        
                        <!-- Draggable threshold markers -->
                        <div class="threshold-marker high-threshold" id="highThreshold" draggable="true">
                            <div class="threshold-handle"></div>
                            <span class="threshold-label">HIGH</span>
                        </div>
                        <div class="threshold-marker low-threshold" id="lowThreshold" draggable="true">
                            <div class="threshold-handle"></div>
                            <span class="threshold-label">LOW</span>
                        </div>
                        
                        <!-- Zone fills -->
                        <div class="zone-fill low-zone-fill" id="lowZoneFill"></div>
                        <div class="zone-fill high-zone-fill" id="highZoneFill"></div>
                    </div>
                    <div class="zone-labels">
                        <span class="zone-label low">LOW ZONE</span>
                        <span class="zone-label mid">MEDIUM ZONE</span>
                        <span class="zone-label high">HIGH ZONE</span>
                    </div>
                </div>
                
                <div class="current-pitch">
                    <span id="currentFrequency">-- Hz</span>
                    <span id="currentPitchLabel" class="pitch-state">WAITING</span>
                </div>
            </div>
            
            <!-- Calibration Controls -->
            <div class="calibration-controls">
                <div class="calibrate-btn-group">
                    <button id="calibrateLow" class="calibrate-btn low">
                        <span class="btn-label">ðŸŽµ CALIBRATE LOW</span>
                        <span class="btn-value" id="lowValue">-- Hz</span>
                        <div class="recording-ring" id="lowRecordingRing"></div>
                    </button>
                    <button id="calibrateHigh" class="calibrate-btn high">
                        <span class="btn-label">ðŸŽµ CALIBRATE HIGH</span>
                        <span class="btn-value" id="highValue">-- Hz</span>
                        <div class="recording-ring" id="highRecordingRing"></div>
                    </button>
                </div>
                
                <p class="calibrate-hint">
                    Click a button and hold your pitch for 2 seconds.<br>
                    Or drag the threshold markers to adjust manually.
                </p>
                
                <div class="threshold-display">
                    <div class="threshold-info low">
                        <span class="label">Low Threshold:</span>
                        <span class="value" id="lowThresholdValue">180 Hz</span>
                    </div>
                    <div class="threshold-info high">
                        <span class="label">High Threshold:</span>
                        <span class="value" id="highThresholdValue">280 Hz</span>
                    </div>
                </div>
            </div>
            
            <!-- Test Section -->
            <div class="test-section-inline">
                <div class="test-paddle-inline">
                    <span class="test-label">TEST:</span>
                    <div class="paddle-track horizontal">
                        <div class="paddle-indicator" id="testPaddle"></div>
                        <span class="track-label left">DOWN</span>
                        <span class="track-label right">UP</span>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="calibrate-actions">
                <button id="resetCalibration" class="btn btn-secondary">
                    <span>â†» RESET TO DEFAULTS</span>
                </button>
                <a th:href="@{/singleplayer}" class="btn btn-primary">
                    <span>ðŸŽ® PLAY GAME</span>
                </a>
            </div>
        </div>
            <!-- Main Visualizer Section -->
            <div class="visualizer-section">
                <div class="viz-row">
                    <div class="viz-panel">
                        <h3>SPECTROGRAM</h3>
                        <canvas id="spectrogramCanvas" width="380" height="150"></canvas>
                    </div>
                    <div class="viz-panel">
                        <h3>WAVEFORM</h3>
                        <canvas id="waveformCanvas" width="380" height="150"></canvas>
                    </div>
                </div>
                
                <div class="viz-panel full-width">
                    <h3>FREQUENCY SPECTRUM</h3>
                    <canvas id="frequencyCanvas" width="780" height="100"></canvas>
                </div>
                
                
        </main>
        
        <footer th:replace="~{fragments/footer :: footer}"></footer>
    </div>
    
    <script th:src="@{/js/audio-visualizer.js}"></script>
    <script th:src="@{/js/calibration.js}"></script>
</body>
</html>
